################################################################################
# Example usage



import os
try:
    os.remove("logs/wasm.log")
except Exception as e:
    print(e)

import logging
# from FS import FS
logging.basicConfig(
    filename="logs/wasm.log",
    level=logging.INFO,
    format="%(asctime)s - %(levelname)s - %(message)s",
)

import sys
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..', 'src')))
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..', 'testing')))
import time
from services.lok_service import LokService
from JS2PY import LOK_JS2PY

lok = LOK_JS2PY("testing/js_testing/test5.wasm")
lok.HEAP32[5948976//4] = 11191872
lok.HEAP32[5948960//4] =  5524807

#5913984  expect 776 , but current value 1456??
# this is the first time where 5913984 no longer 0
#from funcname 92773, {0: 136, 1: 17, 2: 2624, 3: 0, 4: 0, 5: 0, 6: 65660, 7: 56, 8: 0, 9: 0, 10: 5949296, 11: 0, 12: 0, 34: 17356048, 35: 17356184, 5084484: 4939776, 5202024: 12319328, 5913980: 0, 5913984: 56, 5913988: 2624, 5914000: 17356048, 5914448: 1427084056, 5914456: 4096, 5949232: 0}
#'invoke_iii' (19177, 5272236, 5949232) ||| {5913980: 0, 5913984: 56, 5913988: 2624, 5913992: 11191872, 5913996: 17355504, 5914000: 17356184, 5914004: -1, 5914008: -14, 5914012: 1427084056, 5914016: 0, 5914020: 0, 5914024: 5914016, 5914028: 5914016, 5914032: 5914024, 5914036: 5914024, 5914040: 17350656, 5914044: 12444464, 5914048: 17352360, 5914052: 13223880, 5914056: 17246048, 5914060: 13693304, 5914064: 17355208, 5914068: 14141912, 5914072: 17166640, 5914076: 17166640, 5914080: 17353336, 5914084: 17353336, 5914088: 17352952, 5914092: 17352952, 5914096: 17352752, 5914100: 17352752, 5914104: 17352304, 5914108: 17352304, 5914112: 17354624, 5914116: 17354624, 5914120: 17355152, 5914124: 17355152, 5914128: 17354360, 5914132: 17354360, 5914136: 17355448, 5914140: 17355448, 5914144: 17354856, 5914148: 17354856, 5914152: 17355792, 5914156: 17355792, 5914160: 12443872, 5914164: 12443872, 5914168: 17123656, 5914172: 17123656, 5914176: 12909488, 5914180: 12909488, 5914184: 5914176, 5914188: 5914176, 5914192: 5914184, 5914196: 5914184, 5914200: 5914192, 5914204: 5914192, 5914208: 5914200, 5914212: 5914200, 5914216: 5914208, 5914220: 5914208, 5914224: 5914216, 5914228: 5914216, 5914232: 5914224, 5914236: 5914224, 5914240: 5914232, 5914244: 5914232, 5914248: 5914240, 5914252: 5914240, 5914256: 5914248, 5914260: 5914248, 5914264: 5914256, 5914268: 5914256, 5914272: 5914264, 5914276: 5914264, 5914280: 0, 5914284: 0, 5914288: 0, 5914292: 0, 5914296: 0, 5914300: 0, 5914304: 0, 5914308: 0, 5914312: 0, 5914316: 0, 5914320: 0, 5914324: 0, 5914328: 0, 5914332: 0, 5914336: 0, 5914340: 0, 5914344: 0, 5914348: 0, 5914352: 0, 5914356: 0, 5914360: 0, 5914364: 0, 5914368: 0, 5914372: 0, 5914376: 0, 5914380: 0, 5914384: 0, 5914388: 0, 5914392: 0, 5914396: 0, 5914400: 0, 5914404: 0, 5914408: 6166976, 5914412: 6166976, 5914416: 0, 5914420: 0, 5914424: 11191872, 5914428: 6166976, 5914432: 0, 5914436: 0, 5914440: 0, 5914444: 0, 5914448: 1427084056, 5914452: 4096, 5914456: 4096}
#from funcname 6090, {0: 4939776, 1: 32, 2: 16, 3: 5949296, 4: 0, 5: 4365577, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 5084484: 4939776, 5202024: 12319328, 5913980: 0, 5913984: 56, 5913988: 2624, 5914000: 17356184, 5914448: 1427084056, 5914456: 4096, 5949232: 17356064}
#from funcname 6090, {0: 4939776, 1: 56, 2: 16, 3: 5949284, 4: 0, 5: 5947810, 6: 301, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 5084484: 4939776, 5202024: 12319328, 5913980: 0, 5913984: 0, 5913988: 2624, 5914000: 17356184, 5914448: 1427084056, 5914456: 4096, 5949232: 0}
#from funcname 6090, {0: 4939776, 1: 56, 2: 16, 3: 5949284, 4: 0, 5: 5947810, 6: 301, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 5084484: 4939776, 5202024: 12319328, 5913980: 0, 5913984: 48, 5913988: 2624, 5914000: 17356184, 5914448: 1427084056, 5914456: 4096, 5949232: 17355808}
#from funcname 92773, {0: 80, 1: 10, 2: 2544, 3: 0, 4: 0, 5: 0, 6: 124, 7: 48, 8: 0, 9: 0, 10: 5949312, 11: 0, 12: 0, 34: 17356184, 35: 17356264, 5084484: 4939776, 5202024: 12319328, 5913980: 0, 5913984: 48, 5913988: 2544, 5914000: 17356184, 5914448: 1427084056, 5914456: 4096, 5949232: 17355808}#

lok._AT_INIT()
lok._AT_MAIN()
a = LokService()
a.login()
token = a.accessToken

URL = f"wss://socf-lok-live.leagueofkingdoms.com/socket.io/?EIO=4&transport=websocket&token={token}"
lok._WS_Create(URL, '', 17058,17691,14198,17692,14199 )
print('\ndebug started')
# set breakpoint at 
#  def _WS_Create
# >> on_message_wrapper

#track this const 5913980
#track this const 5913984
#track this const 5913988
# culprit found 5914000


# 2024-08-25 00:30:48,424 - INFO - from funcname 93115, placeholder 3 : 4096
# 2024-08-25 00:30:48,425 - INFO - from funcname 93115, placeholder 4 : 1114112
# expect 11191872 for from funcname 93115, placeholder 3
# expect 0 for from funcname 93115, placeholder 4

# 2024-07-28 21:15:01,881 - INFO - _syscall4 not implemented
# Fill missing function if any
time.sleep(300)